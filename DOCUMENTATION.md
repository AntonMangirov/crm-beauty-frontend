## CRM Beauty Frontend — Документация

### Назначение

SPA для клиентов и мастеров: просмотр профилей мастеров, выбор услуг, запись, личная панель мастера.

### Технологии

- React 19 + TypeScript
- Vite — сборщик и dev сервер
- Material-UI (MUI) — компоненты UI
- Axios — HTTP клиент для запросов к бэкенду
- Leaflet + react-leaflet — карты (OpenStreetMap)
- React Router — маршрутизация
- React Hook Form — управление формами
- Google reCAPTCHA v3 — защита от ботов
- date-fns — работа с датами

### Структура проекта

```
src/
├── app/
│   └── App.tsx              # Корневой компонент приложения
├── pages/                   # Страницы приложения
│   ├── Dashboard/           # Главная страница
│   ├── MasterPage/          # Публичная страница мастера
│   ├── MasterCabinet/       # Личный кабинет мастера
│   ├── CalendarPage/        # Календарь записей мастера
│   ├── ClientsPage/         # Список клиентов
│   ├── ServicesPage/         # Управление услугами
│   ├── BookPage/            # Страница записи
│   └── BookingSuccess/       # Страница успешной записи
├── components/              # Переиспользуемые компоненты
│   ├── BookingWizard/       # Пошаговый визард записи
│   ├── MasterProfile/       # Профиль мастера
│   ├── LocationMap/         # Карта местоположения
│   └── ...
├── api/                     # API клиенты
│   ├── index.ts            # Базовая конфигурация Axios
│   ├── masters.ts          # API мастеров
│   ├── services.ts          # API услуг
│   └── me.ts                # API личного кабинета
├── utils/                   # Утилиты
│   ├── recaptcha.ts        # Работа с reCAPTCHA
│   ├── loadRecaptcha.ts    # Загрузка скрипта reCAPTCHA
│   └── imageUrl.ts         # Нормализация URL изображений
└── theme/                   # Тема MUI
```

### Основной функционал

**Публичная часть:**
- Просмотр профилей мастеров с фото, описанием и услугами
- Карта с местоположением мастера (Leaflet)
- Пошаговый визард записи (выбор услуги, времени, контактные данные)
- Защита от ботов через Google reCAPTCHA v3

**Личный кабинет мастера:**
- Управление профилем (имя, описание, адрес, фото)
- Управление услугами (создание, редактирование, удаление)
- Календарь записей с возможностью подтверждения/отмены
- Список клиентов с историей посещений
- Загрузка фото работ к записям

### Ключевые компоненты

- `BookingWizard/` — пошаговый визард записи:
  - `StepSelectService` — выбор услуги
  - `StepSelectTime` — выбор даты и времени
  - `StepClientForm` — контактные данные клиента
- `MasterProfile` — публичный профиль мастера
- `LocationMap` — карта местоположения на основе Leaflet
- `PhotoUploader` — загрузка фото работ
- `ClientHistoryModal` — история посещений клиента

### API-слой (клиент)

- `src/api/index.ts` — базовая конфигурация Axios:
  - Автоматическое добавление JWT токена к запросам
  - Обработка ошибок авторизации (редирект на `/login` при 401)
- `src/api/masters.ts` — публичные API мастеров
- `src/api/services.ts` — публичные API услуг
- `src/api/me.ts` — приватные API личного кабинета

**Авторизация:** Для приватных запросов JWT токен автоматически добавляется из `localStorage.authToken` через интерцептор Axios.

### Утилиты

- `src/utils/recaptcha.ts` — получение токена Google reCAPTCHA v3
- `src/utils/loadRecaptcha.ts` — динамическая загрузка скрипта reCAPTCHA

### Переменные окружения

Создайте файл `.env` на основе `.env.example`:

- `VITE_API_URL` — URL бэкенда (по умолчанию `http://localhost:3000`)
- `VITE_RECAPTCHA_SITE_KEY` — Site Key для Google reCAPTCHA v3 (получите на https://www.google.com/recaptcha/admin)

**Примечание:** В режиме разработки, если `VITE_RECAPTCHA_SITE_KEY` не установлен, reCAPTCHA токен не будет отправляться, и бэкенд может пропустить проверку (если настроено).

### Обработка ошибок

- Все ошибки API отображаются пользователю через `SnackbarProvider`
- `console.error` используется только для критических ошибок в catch-блоках
- Ошибки валидации обрабатываются с детальными сообщениями от бэкенда

### Работа с датами и временем

- Все даты/время хранятся на бэкенде в UTC
- На фронтенде используется локальное время для отображения
- При отправке данных на сервер происходит преобразование в UTC

### Сборка и запуск

```bash
# Установка зависимостей
npm install

# Запуск dev сервера
npm run dev

# Сборка для продакшена
npm run build

# Предпросмотр production сборки
npm run preview
```

Приложение будет доступно по адресу `http://localhost:5173` (или другому порту, если 5173 занят).
